<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="Css/Css_Final.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body>
    <header></header>
    <div id="nav"></div>
    <div class="boxContainer">
        <table class="elementsContainer">
        <tr>
        <td>
        <input type="text" placeholder="Suche nach Spiel"
        class="search" onchange="suche(this.value)">
        </td>
        <td>
        <a href="kaufseite.html"> <i class="material-icons">search</i>
        </a>
        </td>
        </tr>
        </table>
    </div>
    <a href="warenkorb.html"><img id="Warenkorb" src="Bilder/Warenkorb.png" alt="Warenkorb"/></a>
    <div class="slideshow-container">
        <div class="mySlides fade">
            <div class="numbertext">1 / 3</div>
            <a href="kaufseite.html?spielId=5"><img class="slideIMG" src="Bilder/Banner1.jpg" style="width:100%" ></a>
            <div class="text"></div>
        </div>
    
        <div class="mySlides fade">
            <div class="numbertext">2 / 3</div>
            <a href="kaufseite.html?spielId=8"><img class="slideIMG" src="Bilder/Banner2.jpg" style="width:100%" ></a>
            <div class="text"></div>
        </div>

        <div class="mySlides fade">
            <div class="numbertext">3 / 3</div>
            <a href="kaufseite.html?spielId=7"><img class="slideIMG" src="Bilder/Banner3.jpg"style="width:100%"></a>
            <div class="text"></div>
        </div>
    <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
    <a class="next" onclick="plusSlides(1)">&#10095;</a>
    </div>
    <div class="dots">
        <span class="dot" onclick="currentSlide(1)"></span>
        <span class="dot" onclick="currentSlide(2)"></span>
        <span class="dot" onclick="currentSlide(3)"></span>
    </div> 
    <h2>Top Games</h2>
    <div id="dyntarget" class="topgames"></div> 
    <footer>
    </footer>
</body>

<!-- Eingebundene Scripts: -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="JQuery_JS/Sortierung.js"></script>
<script src="JQuery_JS/Script.js"></script>
<script src="JQuery_JS/urlParameter.js"></script>
<script>
    //Erstellung Header
    createHeader();
    // Erstellung des Navs
    createNav();
    // Erstellung des Footers
    createFooter();
    // Funktion bei der Suchleiste
    function suche(val) {
        $.ajax({
            url: "http://localhost:8000/api/spiel/alle",
            method: "GET",
            dataType: "json"
        })
        .done(function(httpResponse) {
            var list = httpResponse.daten
            var resultlist = [];
            for (var i=0; i< list.length; i++) {
                //Makes exact Searchinput like "Cyberpunk 2077 (Day-One-Edition)" possible
                if (list[i].spielname.toLowerCase() === val.toLowerCase()) {
                    resultlist.push(list[i]);
                }
                else if (list[i].spielname.toLowerCase().includes(val.toLowerCase())) {
                    resultlist.push(list[i]);
                }
            }
            // //Makes "one word" - Searchinput like "Cyberpunk" or "Borderlands" possible
            // else if (list[i].spielname.split(' ')[0].toLowerCase() == val.toLowerCase()) {
            //         resultlist.push(list[i]);
            //     }
            
            if (resultlist.length == 0) {
                alert("Keine Spiel zur Suchanfrage gefunden! Bitte erneut versuchen!");
            }
            else if (resultlist.length == 1) {
                window.location.replace("kaufseite.html?spielId=" + resultlist[0].id);
            }
            else {
                var ids = "";
                for (var x=0; x < resultlist.length;x++){
                    ids += resultlist[x].id  + " ";
                }
                window.location.replace("spielauswahl.html?ids=" + ids);
            }

        })
        .fail(function(jqXHR, statusText, error) {
            console.log(statusText);
            alert("Es ist ein Fehler aufgetreten");
        })
    }

    // Erstellung der unten erscheinten Spielauswahl "Top Games"
    $(document).ready(function() {
        $.ajax({
            url: "http://localhost:8000/api/spiel/alle/erscheinungsdatum",
            method: "GET",
            dataType: "json"
        })
        .done(function(httpResponse) {
            var list = httpResponse.daten
            console.log(list.length);
            // Sorting list, latest games first in list
            // for (var i=0; i < list.length; i++) {
            //     for (var j=i+1; j < list.length; j++) {
            //         if (list[i].erscheinungsjahr < list[j].erscheinungsjahr) {
            //             var old = list[i];
            //             list[i] = list[j];
            //             list[j] = old;
            //         }
            //     }
            // }
            var anzahl;
            if (list.length > 5) {
                anzahl = 5
            }
            else {
                anzahl = list.length;
            }
            for (var i=0; i < anzahl; i++) {
                $("DIV#dyntarget").append(
                    $("<div>")
                        .addClass("elementmittig")
                        .append($("<a>").attr("href","kaufseite.html?spielId=" + list[i].id).append($("<img>").attr("src",list[i].bilder[0].bildpfad)))
                        .append($("<div>").addClass("PreisBeschreibungContainer").append($("<p>").addClass("Plattform").text("Plattform: ").append($("<strong>").text(list[i].spielplattform.name))).append($("<p>").addClass("Preis").text(toKomma(list[i].bruttokaufpreis) + "â‚¬" )).append($("<p>").addClass("Spielname").text(list[i].spielname)))
                        .append($("<div>").addClass("AnsehenContainer").append($("<a>").attr("href","kaufseite.html?spielId="+list[i].id).append($("<button>").addClass("ZumSpiel").text("Spiel ansehen")))));
            }
        })
        .fail(function(jqXHR, statusText, error) {
            console.log(statusText);
            alert("Es ist ein Fehler aufgetreten");
        })
});
</script>
</html>