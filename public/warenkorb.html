<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="Css/Css_Final.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<script src="Script.js"></script>
<script language="JavaScript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <header>
        <h1>Ninja-Gaming
            <br>Dein Shop fürs Ausleihen und Kaufen von Games
        </h1>
        <img id ="titelbild" src="Bilder/Ninja.png" alt="Ninja">
    </header>

    <div id="nav">
		<a href="index.html"> Startseite</a>
		<a href="spielauswahl.html?spielplattformId=2"> PC</a>
		<a href="spielauswahl.html?spielplattformId=1"> PS4</a>
		<a href="spielauswahl.html?spielplattformId=3"> XBOX</a>
		<a href="impressum.html"> Impressum</a>
		<a href="kontakt.html">Kontakt</a>
    </div>
    <h1 id="warenkorb_h1">Warenkorb</h1>
    <div class="warenkorb_main">
<!--    <div class="warenkorb_spiel">
            <a href="kaufseite.html"><img class="warenkorb_spielanzeige" src="Bilder/The Elder Scrolls Online - Greymoor [Standard Edition].jpg" alt="Spiel"/></a>
            
            <div class="warenkorb_spielbeschreibung">
                <h4>The Elder Scrolls Online - Greymoor [Standard Edition]</h4>
                <h5>Plattform: PS4</h5>
                <h5>Erscheinungsjahr: 2020</h5>    
            </div>
            <div class="warenkorb_kaufart">
                <h4>Kaufpreis UVP</h4>  
            </div>

            <div class="warenkorb_preis">
                <h4>59,99€</h4>
            </div>
            
            <div class="warenkorb_rechterContainer">

                <button class="warenkorb_entfernen">
                    entfernen
                </button>
                
            </div>
        </div>
        <div class="warenkorb_spiel">
            <a href="kaufseite.html"><img class="warenkorb_spielanzeige" src="Bilder/The Elder Scrolls Online - Greymoor [Standard Edition].jpg" alt="Spiel"/></a>
            
            <div class="warenkorb_spielbeschreibung">
                <h4>The Elder Scrolls Online - Greymoor [Standard Edition]</h4>
                <h5>Plattform: PS4</h5>
                <h5>Erscheinungsjahr: 2020</h5>    
            </div>
            <div class="warenkorb_kaufart">
                <h4>Geliehen für:</h4>  
                <select class="dropdown_warenkorb">
                    <option>1 Tag</option>
                    <option>2 Tage</option>
                    <option>3 Tage</option>
                    <option>4 Tage</option>
                    <option selected>5 Tage</option>
                    <option>7 Tage / 1 Woche</option>
                    <option>14 Tage / 2 Wochen</option>
                </select> 
            </div>

            <div class="warenkorb_preis">
                <h4>25,00€</h4>
            </div>
            
            <div class="warenkorb_rechterContainer">

                <button class="warenkorb_entfernen">
                    entfernen
                </button>
                
            </div>
            
        </div>
        <div class="gesamtpreis_warenkorb">
            <hr>
            <div class="gesamtpreis_warenkorb_links">
                <h4>Enth. MwSt.</h4>
                <h3>Gesamtsumme</h3>
            </div>
            <div class="gesamtpreis_warenkorb_rechts">
                <h4>xx,xx€</h4>
                <h3>xx,xx€</h3>
            </div>
        </div> -->


    </div>
    <div class="zur_kasse">
        <a href="kasse.html"><button>Zur Kasse</button></a>
    </div>

    <footer>
        <div class="Footer_links">
            <a href="impressum.html">Impressum</a> <br><br>
            <a href="kontakt.html">Kontakt</a> <br><br>
            <a href="support.html">Support</a>
        </div>
        <div class="Footer_mitte">
            <p>Zahlungsarten:</p> <br>
            <img src="Bilder/Paypal-logo.jpg" alt="Paypal" >
            <img src="Bilder/Barzahlung_logo.png" alt="Barzahlung" >
        </div>
 
        <div class="Footer_rechts">
            <p>Soziale Netzwerke:</p>
            <a href="https://de-de.facebook.com/"><img src="Bilder/Facebook_logo.png" alt="Facebook"></a>
            <a href="https://twitter.com/?lang=de"><img src="Bilder/Twitter_logo.png" alt="Twitter"></a>
            <a href="https://www.instagram.com/"><img src="Bilder/Instagram_logo.jpg" alt="Facebook"></a>
        </div>
    </footer>
    <script>

// WARENKORB WIRD NOCH GEÄNDERT (SO WIE IN DER PRAKTIKUMSSTUNDE GEZEIGT MIT SESSION ID USW)
        // initialisierung (globale variable)
        var basket = [];
        

        
        $('document').ready(function() {

            // schauen ob in der session bereits ein warenkorb existiert, falls ja diesen holen
            if (existsSessionItem('basket')){
                basket = getJSONSessionItem('basket');
            }
             
            // produkt in warenkorb hinzufügen bzw. menge ändern
            if (existsUrlParameter('addToBasket')) {
                // id aus parameter holen
                var productId = getUrlParameterValue('addToBasket');
                var leihdauer = 0;
                if (existsUrlParameter('leihdauer')){
                    var leihdauer = getUrlParameterValue('leihdauer');
                }
            
                var loadedProduct;
                $.ajax({
                    url: 'http://localhost:8000/api/spiel/gib/' + productId,
                    method: 'GET',
                    dataType: 'json'
                })
                .done(function(httpResponse) {
                    loadedProduct = httpResponse.daten
                })
                .fail(function(jqXHR, statusText, error) {
                console.log(statusText);
                alert("Es ist ein Fehler aufgetreten");
                });


                var bestellpositionen;
                //unterscheiden ob gekauft oder geliehen
                if (leihdauer > 0){    //geliehen
                    bestellpositionen = {
                        spielID = productId,
                        spiel = loadedProduct,
                        gekauft = 0,
                        leihzeit = leihdauer
                    }
                }
                else {      //gekauft
                    var bestellpositionen = {
                        
                        spielID = productId,
                        spiel = loadedProduct,
                        gekauft = 1,
                        leihzeit = 0
                    };
                }
                basket.push(bestellpositionen);

                setJSONSessionItem('basket', basket);
            }
        
            showBasket();
        
        });

        function showBasket() {
            // aktuelle warenkorbdaten in konsole anzeigen lassen
            console.log(basket);
            if (basket.length == 0) {
            // warenkorb_leer noch in css anlegen
            //        $('DIV.warenkorb_main').append($('<h2>').addClass('warenkorb_leer').text('Der Warenkorb ist leer');
            }
            else {
                //hier dynamischen Code eintragen 
                //angezeigt werden muss: Spielbild, Spielname, Plattform, Erscheinungsjahr, Gekauft/Leihdauer,
                // Preis und entfernen Button
                //ganz unten noch enth. MwSt. und Gesamtsumme  

                for (i = 0; i < basket.bestellpositionen.length; i++){
                    //spiel.bilder[1].bildpfad
                }
            }
        }
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        // $(document).ready(function() {
        //     $.ajax({
        //         url: "http://localhost:8000/api/bestellung/alle",
        //         method: "GET",
        //         dataType: "json"
        //     })
        //     .done(function(httpResponse) {
        //         var list = httpResponse.daten
                
        //         for (i = 0; i < 1; i++){
        //             var b = 0; //also in bestellung/alle die Position in der Liste (hier jetzt zum Beispiel die erste Bestellung) (später dann ändern)
        //             // was für i<...??
        //             for (i = 0; i < list[b].bestellpositionen.length; i++){
        //                 $('DIV.warenkorb_main').append(
        //                     $('<div>')
        //                         .addClass('warenkorb_spiel')
        //                         .append($('<a>').attr('href','kaufseite.html?spielId='+list[b].bestellpositionen[i].spielid).append($('<img>').addClass('warenkorb_spielanzeige').attr('src', list[b].bestellpositionen[i].spiel.bilder[0].bildpfad)))
        //                         .append($('<div>').addClass('warenkorb_spielbeschreibung').append($('<h4>').text(list[b].bestellpositionen[i].spiel.spielname)).append($('<h5>').text('Plattform: ' + list[b].bestellpositionen[i].spiel.spielplattform.name)).append($('<h5>').text('Erscheinungsjahr: ' + list[b].bestellpositionen[i].spiel.erscheinungsjahr)))
        //                         .append(function(){
        //                             if (list[b].bestellpositionen[i].gekauft == 0){ //0 heißt das Spiel wird geliehen
        //                                 return $('<div>').addClass('warenkorb_kaufart').append($('<h4>').text('Geliehen für: ' + list[b].bestellpositionen[i].leihzeit + ' Tage'))
        //                             }else if (list[b].bestellpositionen[i].gekauft == 1){ //1 heißt das Spiel wird gekauft
        //                                 return $('<div>').addClass('warenkorb_kaufart').append($('<h4>').text('Kaufpreis UVP'))
        //                             }
        //                         })
        //                         .append($('<div>').addClass('warenkorb_preis').append($('<h4>').text(list[b].bestellpositionen[i].bruttopreis + '€')))
        //                         .append($('<div>').addClass('warenkorb_rechterContainer').append($('<button>').addClass('warenkorb_entfernen').text('entfernen'))))

        //             }
        //             $('DIV.warenkorb_main').append(
        //                 $('<div>')
        //                     .addClass('gesamtpreis_warenkorb')
        //                     .append($('<hr>'))
        //                     .append($('<div>').addClass('gesamtpreis_warenkorb_links').append($('<h4>').text('Enth. MwSt.')).append($('<h3>').text('Gesamtsumme')))
        //                     .append($('<div>').addClass('gesamtpreis_warenkorb_rechts').append($('<h4>').text(list[b].total.mehrwertsteuer + '€').append($('<h3>').text(list[b].total.brutto + '€'))))
        //             );
                    
        //         }
        //     })
        //     .fail(function(jqXHR, statusText, error) {
        //         console.log(statusText);
        //         alert("Es ist ein Fehler aufgetreten");
        //     })
        // });
    </script>
</body>
</html>