<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="Css/Css_Final.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>

<body>
    <header>
        <h1>Ninja-Gaming
            <br>Dein Shop fürs ausleiehen und kaufen von Games
        </h1>
        <img id ="titelbild" src="Bilder/Ninja.png" alt="Ninja">
    </header>

    <div id="nav">
		<a href="index.html"> Startseite</a>
		<a href="spielauswahl.html?spielplattformId=2"> PC</a>
		<a href="spielauswahl.html?spielplattformId=1"> PS4</a>
		<a href="spielauswahl.html?spielplattformId=3"> XBOX</a>
		<a href="impressum.html"> Impressum</a>
		<a href="kontakt.html">Kontakt</a>
    </div>
    

    <a href="warenkorb.html"><img id="Warenkorb" src="Bilder/Warenkorb.png" alt="Warenkorb"/></a>
    <h2 id="Ueberschrifft">
        <br><h3 id="Info"></h3>
    </h2>
    <hr>
	<img id="Bild" class="fifa" src="" alt="BildzumSpiel">	
	<div class="boxx" id="Beschreibung">
	</div>
	<div id="Preisdaten" class="boxx1">
	</div>

	<div id="Buttons" class="kaufen_button">
    
    <!-- <select class="dropdownKauf">
		<option disabled selected>Anzahl Tage auswählen</option>
		<option>1 Tag</option>
		<option>2 Tage</option>
		<option>3 Tage</option>
		<option>4 Tage</option>
        <option>5 Tage</option>
        <option>7 Tage / 1 Woche</option>
        <option>14 Tage / 2 Wochen</option>
    </select>   -->
    </div>
    <br><br>
	<h2>Ähnliche Spiele</h2>
	</div> 

        <div class="topgames" id="dyntarget">
            <!--Dynamierte Elemente, hier rendert das Script die Spiele ein-->
        </div>
	
        <footer>
            <div class="Footer_links">
                <a href="impressum.html">Impressum</a> <br><br>
                <a href="kontakt.html">Kontakt</a> <br><br>
                <a href="support.html">Support</a>
            </div>
            <div class="Footer_mitte">
                <p>Zahlungsarten:</p> <br>
                <img src="Bilder/Paypal-logo.jpg" alt="Paypal" >
                <img src="Bilder/Barzahlung_logo.png" alt="Barzahlung" >
            </div>
     
            <div class="Footer_rechts">
                <p>Soziale Netzwerke:</p>
                <a href="https://de-de.facebook.com/"><img src="Bilder/Facebook_logo.png" alt="Facebook"></a>
                <a href="https://twitter.com/?lang=de"><img src="Bilder/Twitter_logo.png" alt="Twitter"></a>
                <a href="https://www.instagram.com/"><img src="Bilder/Instagram_logo.jpg" alt="Facebook"></a>
            </div>
        </footer>
</body>
<script src="JQuery_JS/urlParameter.js"></script>
<script>
    $(document).ready(function() {
        if(!hasUrlParameters()){
            $('H2#Ueberschrifft').text('Fehlerhaft');
        }
        else {
            var id = getUrlParameterValue('spielId');
            $.ajax({
            url: "http://localhost:8000/api/spiel/gib/" + id,
            method: "GET",
            dataType: "json"
            })
            .done(function(httpResponse) {
                var spiel = httpResponse.daten;
                $('H2#Ueberschrifft').text(spiel.spielname);
                $('H3#Info').text("Plattform: " + spiel.spielplattform.name + " | Genre: " + spiel.genre.name);
                $('IMG#Bild').attr("src",spiel.bilder[0].bildpfad);
                $('DIV#Beschreibung').append($("<h3>").text(spiel.spielname));
                $('DIV#Beschreibung').append($("<p>").text(spiel.beschreibung));
                $('DIV#Preisdaten').append($("<h3>").text("Kaufpreis: "));
                $('DIV#Preisdaten').append($("<h3>").text(spiel.bruttokaufpreis + " €"));
                $('DIV#Preisdaten').append($("<h3>").text("Preis zum leihen: "));
                $('DIV#Preisdaten').append($("<h3>").text( spiel.bruttoleihpreis + " €/Tag"));
                $('DIV#Buttons').addClass("kaufen_button").append($("<a>").attr("href","warenkorb.html?addToBasket="+spiel.id).append($("<button>").addClass("button_innen").text("Kaufen")));
                $('DIV#Buttons').append($("<select id='Dropdown'>").addClass("dropdownKauf").attr('onchange','urlleihdauer()'));
                $('SELECT#Dropdown').append($("<option>").text("Anzahl Tage auswählen").attr('disabled','disabled'));
                if (spiel.leihdauer < 7){
                    for (var i=1; i < spiel.leihdauer ; i++) {
                        $('SELECT#Dropdown').append($("<option>").text(i + " Tage"))
                    }
                }
                else {
                    for (var i=1; i < 7 ; i++) {
                        $('SELECT#Dropdown').append($("<option>").text(i + " Tag(e)"))
                    }
                    $('SELECT#Dropdown').append($("<option>").text("7 Tage/Eine Woche"))
                    if (spiel.leihdauer == 14) {
                        $('SELECT#Dropdown').append($("<option>").text("14 Tage/Zwei Wochen"))
                    }
                }
                $('DIV#Buttons').append($("<a id='leihlink'>").attr("href","warenkorb.html?addToBasket="+spiel.id + "&leihdauer=" + $("SELECT#Dropdown").find(":selected").text()).append($("<button>").addClass("button_innen").text("Leihen")));

            })
            .fail(function(jqXHR, statusText, error) {
            console.log(statusText);
            alert("Es ist ein Fehler aufgetreten");
            })
        }
    })
</script>
<script>
    function urlleihdauer() {
        $("a#leihlink").attr("href", "warenkorb.html?addToBasket="+ getUrlParameterValue('spielId') + "&leihdauer=" + $("SELECT#Dropdown").find(":selected").text().split(" ")[0]);
    }
</script>
<script>
    $(document).ready(function() {
        $.ajax({
            url: "http://localhost:8000/api/spiel/alle",
            method: "GET",
            dataType: "json"
        })
        .done(function(httpResponse) {
            var list = httpResponse.daten
            // Sorting list, latest games first in list
            for (var i=0; i < list.length; i++) {
                for (var j=i+1; j < list.length; j++) {
                    if (list[i].erscheinungsjahr < list[j].erscheinungsjahr) {
                        var old = list[i];
                        list[i] = list[j];
                        list[j] = old;
                    }
                }
            }

            for (var i=0; i < 5; i++) {
                $("DIV#dyntarget").append(
                    $("<div>")
                        .addClass("elementmittig")
                        .append($("<a>").attr("href","kaufseite.html?spielId=" + list[i].id).append($("<img>").attr("src",list[i].bilder[0].bildpfad)))
                        .append($("<div>").addClass("PreisBeschreibungContainer").append($("<p>").addClass("Plattform").text("Plattform: ").append($("<strong>").text(list[i].spielplattform.name))).append($("<p>").addClass("Preis").text(list[i].bruttokaufpreis + "€" )).append($("<p>").addClass("Spielname").text(list[i].spielname)))
                        .append($("<div>").addClass("AnsehenContainer").append($("<a>").attr("href","kaufseite.html?spielId="+list[i].id).append($("<button>").addClass("ZumSpiel").text("Spiel ansehen")))));
            }
        })
        .fail(function(jqXHR, statusText, error) {
            console.log(statusText);
            alert("Es ist ein Fehler aufgetreten");
        })
});
</script>
</html>